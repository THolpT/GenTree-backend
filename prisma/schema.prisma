generator client {
  provider     = "prisma-client"
  output       = "../src/generated"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Person {
  id         String    @id @default(cuid())
  name       String
  givenName  String?
  surname    String?
  gender     Gender?
  birthDate  DateTime?
  birthPlace String?
  marriageDate DateTime?
  marriagePlace String?
  deathDate  DateTime?
  deathPlace String?
  img        String?
  spouseId   String?   @unique
  childId    String?
  treeId     String
  child      Person?   @relation("ParentChildRelation", fields: [childId], references: [id] , onDelete: Cascade)
  parent     Person[]  @relation("ParentChildRelation")
  spouse     Person?   @relation("SpouseRelation", fields: [spouseId], references: [id])
  spouseOf   Person?   @relation("SpouseRelation")
  tree       Tree      @relation(fields: [treeId], references: [id])
}

model User {
  id       String @id @default(cuid())
  login    String
  password String
  email    String @unique
  trees    Tree[]
}

model Tree {
  id       String   @id @default(cuid())
  authorId String?
  name     String   @default("Новое древо")
  persons  Person[]
  author   User?    @relation(fields: [authorId], references: [id])
}

enum Gender {
  MALE
  FEMALE
  UNKNOWN
}
